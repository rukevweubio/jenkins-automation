name: Build, Push, and Deploy Docker Image

on:
  push:
    

env:
  DOCKER_USERNAME: rukevweubio
  DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
  docker_image: mongo
  docker_registry: docker.io

jobs:
  build-and-push:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v3


      - name: docker login 
        uses: docker login ${{secrets.DOCKER_PASSWORD}}| --username=${{env.OCKER_USERNAME}} --password-stdin  

      - name: docker pull image 
        uses: docker pull ${{env.Ddocker_registry}}/${{env.DOCKER_USERNAME}}/docker_image:latest
deploy:
  needs: docker
  runs-on: ubuntu-latest
  concurrent:
    group: deploy production 
    cancel-in-progress: true
  steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Deploy to Docker Hub
      run: |
        
        docker run -d -p 80:80 ${{ env.docker_registry }}/${{env.DOCKER_USERNAME}}/docker_image:latest    